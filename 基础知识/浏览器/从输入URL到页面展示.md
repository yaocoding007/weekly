## 从输入URL到页面加载完的过程

1. 输入URL并回车确认

2. URL解析，浏览器查找当前URL是否存在缓存，并比较缓存是否过期。

3. DNS解析查找域名IP地址 //DNS实际上是一个域名和IP对应的数据库

4. 根据IP建立TCP连接（三次握手）

5. 网络连接发起HTTP请求

6. 服务器处理请求，浏览器接收HTTP响应

7. 渲染页面，构建DOM树。

8. 关闭TCP连接（四次挥手）

   



>  计算机的网络体系结构
>
> - 应用层（HTTP,SMTP.FTP,POP3）
> - 运输层（TCP,UDP）
> - 网络层（IP（路由器））
> - 数据链路层（网桥（CSMA/CD,PPP））
> - 物理层（集线器）



> DNS解析查找域名IP地址
>
> 1. 浏览器缓存
> 2. 本机缓存
> 3. hosts文件
> 4. 路由器缓存
> 5. DNS缓存
> 6. DNS递归查询 根域名-> 一级域名 -> ... -> 目标域名

<img src="/Users/liluyao/Library/Application Support/typora-user-images/image-20210406230640343.png" alt="image-20210406230640343" style="zoom:50%;" />

> 三次握手 
>
> *SYN*：同步序列编号（*Syn*chronize Sequence Numbers）
>
> 
>
> 第一次握手： 客户端发送syn包（syn=j）到服务器，并进入SYN_SEND状态，等待服务器确认（主机向服务器发送一个建立链接的请求）
>
> 第二次握手： 服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个syn包（syn=k），既syn+ack包，此时服务器进入syn_recv状态（服务器接到请求后发送同意连接的信号）
>
> 第三次握手： 客户端收到服务器的syn+ack包，向服务器发送确认包ack（ack=k+1），此包发送完毕，客户端和服务器进入established状态，完成三次握手（主机接到同意信息后，再次向服务器发送了确认信号）
>
> > 三次握手用来保证 浏览器和服务器双方都有数据的接收和发送的能力
>
> 第一次握手 保证了浏览器有发送数据的能力
> 第二次握手 保证了服务器有接收和发送数据的能力
> 第三次握手 保证了浏览器有接收数据的能力



> 四次挥手
>
> 第一次握手是 浏览器发完数据，然后发送FIN请求断开连接。
>
> 第二次握手是 服务器向客户端发送ACK，表示同意。
>
> 第三次握手是 服务器可能还有数据向浏览器发送，所以向浏览器发送ACK同时也发送FIN请求，是第三次握手。
>
> 第四次握手是 浏览器接受返回的ACK，表示数据传输完成。
>
> 
>
> 为什么服务器在接到断开请求时不立即同意断开：当服务器收到断开连接的请求时，可能仍然有数据未发送完成，所有服务器先发送确认信号，等所有数据发送完毕后在同意断开





浏览器内核拿到内容后，渲染大致分为以下几步：
（1）解析html，构建DOM树；同时解析CSS，生成CSS规则树。
（2）合并DOM树和CSS规则树，生成Render树
（3）布局Render树（layout/reflow）,负责各元素的尺寸，位置计算。
（4）绘制render树（paint），绘制页面像素信息。
（5）浏览器会将各层的信息发给GPU。GPU会将各层合成（composite），显示在屏幕上。



`Layout，也称为Reflow，即回流`。一般意味着元素的内容、结构、位置或尺寸发生了变化，需要重新计算样式和渲染树。

`Repaint，即重绘`。意味着元素发生的改变只是影响了元素的一些外观之类的时候（例如，背景色，边框颜色，文字颜色等），此时只需要应用新样式绘制这个元素就可以



##### 什么引起回流：

	1. 页面渲染初始化  
 	2. DOM结构改变，比如删除了某个节点 
 	3. render树变化，比如减少了padding
 	4. 窗口resize
 	5. 最复杂的一种：获取某些属性，引发回流， 很多浏览器会对回流做优化，会等到数量足够时做一次批处理回流， 但是除了render树的直接变化，当获取一些属性时，浏览器为了获得正确的值也会触发回流，这样使得浏览器优化无效

`回流一定伴随着重绘，重绘却可以单独出现`。

##### `优化方案`：

1. 减少逐项更改样式，做好一次性更改样式。或者将样式定义为class，并一次性更新。
2. 避免循环操作dom，创建一个documentFragment或div，在他上面进行所有的dom操作，最后添加到window.document中。
3. 避免多次读取offset等属性，无法避免就将他们缓存到变量中。
4. 将复杂的元素绝对定位或者固定定位，使他们脱离文档流，否则回流代价很高。
   注意：改变字体大小会引起回流。

##### 静态资源

* css 下载时异步的，不会阻塞浏览器构建 DOM 树。但会阻塞渲染
* js脚本处理时，阻塞浏览器的解析（defer 与 async去优化）defer 是延迟执行，而 async 是异步执行。
	async并行下载 下载完就执行
	defer并行下载 文档解析完再执行
* 遇到图片等资源时，直接就是异步下载，不会阻塞解析，下载完毕后直接用图片替换原有src的地方